<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Resume Parser - Modern Layout</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/833/833472.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      color: #333;
    }
    .resume {
      display: flex;
      max-width: 960px;
      margin: 40px auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .left {
      width: 30%;
      background-color: #2f3542;
      color: #fff;
      padding: 30px 20px;
    }
    .right {
      width: 70%;
      background-color: #fff;
      padding: 30px 40px;
    }
    h1 {
      margin-top: 0;
      font-size: 24px;
      text-transform: uppercase;
    }
    .info {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 10px;
    }
    .section-title {
      font-weight: bold;
      font-size: 16px;
      margin: 30px 0 10px;
      text-transform: uppercase;
      border-bottom: 2px solid #007bff;
      padding-bottom: 4px;
    }
    .section-content {
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-line;
    }
    .skills ul, .education ul, .web-links ul {
      padding-left: 20px;
      margin: 0;
    }
    .skills li, .education li, .web-links li {
      margin-bottom: 6px;
    }
    .download-btn {
      text-align: center;
      margin: 30px;
    }
    .download-btn button {
      padding: 10px 20px;
      font-size: 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .download-btn button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>

  <div class="resume" id="resumeContent">
    <div class="left">
      <h1 id="name">Name</h1>
      <div class="info" id="email">üìß Email</div>
      <div class="info" id="phone">üìû Phone</div>
      <div class="info" id="location">üìç Location</div>
      <div class="section-title">Skills</div>
      <div class="skills" id="skills"><ul><li>Loading...</li></ul></div>
    </div>

    <div class="right">
      <div class="section-title">Summary</div>
      <div class="section-content" id="summary">Loading summary...</div>

      <div class="section-title">Education</div>
      <div class="section-content education" id="education"><ul><li>Loading education...</li></ul></div>

      <div class="section-title">Websites, Portfolios, Profiles</div>
      <div class="section-content web-links" id="links"><ul><li>Loading links...</li></ul></div>
    </div>
  </div>

  <div class="download-btn">
    <button onclick="downloadPDF()">‚¨áÔ∏è Download as PDF</button>
  </div>

  <script>
    function extractSection(text, sectionTitle) {
      const sectionAliases = {
        Education: ["Education", "Educational Background"],
        Summary: ["Summary", "Career Objective", "Objective"],
        Skills: ["Skills", "Technical Skills"],
      };

      const aliases = sectionAliases[sectionTitle] || [sectionTitle];
      const allOtherSections = Object.values(sectionAliases)
        .flat()
        .filter(s => !aliases.includes(s))
        .map(s => s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"));

      const startPattern = aliases.map(s => s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")).join("|");
      const endPattern = allOtherSections.length
        ? `(?=\\n(?:${allOtherSections.join("|")})\\b)`
        : "";

      const regex = new RegExp(`(?:${startPattern})\\s*[:\\-]?\\s*\\n?([\\s\\S]*?)${endPattern || '$'}`, "i");
      const match = text.match(regex);

      if (match) {
        return match[1]
          .split("\n")
          .map(line => line.trim())
          .filter(line => line.length > 0);
      }

      return ["Not found"];
    }

    function extractLocation(text) {
      const lines = text.split('\n').map(line => line.trim()).filter(Boolean);
      let location = "Not found";

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].toLowerCase();

        const isContactLine = line.includes('contact') || line.includes('phone') || line.includes('email');
        const nextLine = lines[i + 1] ? lines[i + 1].trim() : '';

        if (isContactLine && nextLine && !/\d/.test(nextLine) && !/@/.test(nextLine)) {
          location = nextLine.replace(/[.,\-]/g, '').trim();
          break;
        }

        if (
          !/@/.test(line) &&
          !/\d/.test(line) &&
          line.length > 2 &&
          line.length < 30 &&
          /^[A-Za-z\s,]+$/.test(line)
        ) {
          if (line.includes("tn") || line.includes("vellore") || line.includes("tamil nadu")) {
            location = line.replace(/[.,\-]/g, '').trim();
            break;
          }
        }
      }

      return location.charAt(0).toUpperCase() + location.slice(1);
    }

    function extractLinks(text) {
  const links = [];
  const linkRegex = /(https?:\/\/[^\s]+)/g;
  const matches = text.match(linkRegex);

  if (matches) {
    for (const url of matches) {
      let label = "Website";
      if (url.includes("linkedin.com")) label = "LinkedIn Profile";
      else if (url.includes("github.com")) label = "GitHub Repository";
      else if (url.includes("leetcode.com")) label = "LeetCode Profile";
      else if (url.includes("portfolio")) label = "Portfolio Website";

      links.push({ label, url });
    }
  }

  return links;
}


    function extractDetails(text) {
      const details = {};
      const lines = text.split('\n').map(l => l.trim()).filter(Boolean);

      let name = "Not found";
      for (const line of lines) {
        if (/^[A-Z\s\.]+$/.test(line) && line.length > 3 && !line.toLowerCase().includes("objective")) {
          name = line;
          break;
        }
      }
      details.Name = name;

      const emailMatch = text.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-z]{2,}/);
      details.Email = emailMatch ? emailMatch[0] : "Not found";

      const phoneMatch = text.match(/(\+?\d{1,4}[\s-]?)?(\d{10}|\d{3}[\s-]\d{3}[\s-]\d{4})/);
      details.Phone = phoneMatch ? phoneMatch[0] : "Not found";

      details.Location = extractLocation(text);
      details.Summary = extractSection(text, "Summary").join("\n");

      const eduLines = extractSection(text, "Education");
      const mergedEdu = [];
      for (let i = 0; i < eduLines.length; i += 2) {
        const line = eduLines[i];
        const nextLine = eduLines[i + 1] || "";
        mergedEdu.push(`${line} - ${nextLine}`);
      }
      details.Education = mergedEdu;

      const knownSkills = [
        "C", "C++", "Java", "Python", "JavaScript", "HTML", "CSS",
        "SQL", "React", "Node", "Express", "MongoDB", "Django", "Flask",
        "MySQL", "Git", "GitHub", "AWS", "Azure", "Linux", "Bootstrap",
        "Kubernetes", "Docker", "DSA", "Problem Solving"
      ];
      const lowerText = text.toLowerCase();
      const detectedSkills = knownSkills.filter(skill =>
        lowerText.includes(skill.toLowerCase())
      );
      details.Skills = Array.from(new Set(detectedSkills));

      details.Links = extractLinks(text);
      return details;
    }

    function downloadPDF() {
      const element = document.getElementById("resumeContent");
      const name = document.getElementById("name").textContent.trim().replace(/\s+/g, '_');
      const filename = name !== "Name" ? `${name}_Resume.pdf` : "resume_parsed_output.pdf";

      const opt = {
        margin: 0.5,
        filename: filename,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(element).save();
    }

    const resumeText = localStorage.getItem('resumeText');
    if (resumeText) {
      const details = extractDetails(resumeText);

      document.getElementById("name").textContent = details.Name;
      document.getElementById("email").textContent = `üìß ${details.Email}`;
      document.getElementById("phone").textContent = `üìû ${details.Phone}`;
      document.getElementById("location").textContent = `üìç ${details.Location}`;
      document.getElementById("summary").textContent = details.Summary;

      const skillsList = details.Skills.map(skill => `<li>${skill}</li>`).join("");
      document.getElementById("skills").innerHTML = `<ul>${skillsList}</ul>`;

      const educationList = details.Education.map(item => `<li>${item}</li>`).join("");
      document.getElementById("education").innerHTML = `<ul>${educationList}</ul>`;

      const linksList = details.Links.map(link => {
  const icon = link.label === "LinkedIn" ? "üîó" :
               link.label === "GitHub" ? "üêô" :
               link.label === "LeetCode" ? "‚öîÔ∏è" :
               link.label === "Portfolio" ? "üåê" :"";

  return `<li>${icon} <strong>${link.label}:</strong> <a href="${link.url}" target="_blank">${link.url}</a></li>`;
}).join("");

document.getElementById("links").innerHTML = `<ul>${linksList}</ul>`;
}else {
      document.getElementById("summary").textContent = "No resume text found. Please upload from the previous page.";
    }
  </script>
</body>
</html>
